### 【推荐】如何在安卓端使用HttpCanary抓到我们需要的封包
##### 首次使用（安装证书及设置）
1. 安卓手机下载HttpCanary（[点击下载](./HttpCanary.apk)，个人自用，不对安全性做任何保证）并安装
2. 打开HttpCanary，点击屏幕中灰色区域的任意位置，进入主页面。

![HttpCanary主页面](./img/17.jpg)

3. 从侧边栏中打开设置页

![打开设置页](./img/18.jpg)

4. 在设置页中选择SSL证书设置(因为需要抓取https包)

![SSL证书设置](./img/19.jpg)

5. 选择安装SSL证书

![安装SSL证书](./img/20.jpg)

6. 【如果能够正常安装】请按照提示自行安装证书，然后跳转到[第14步](#14)
【如果出现以下提示】请继续按照本教程执行(新版安卓加强了权限管控)

![无法自动安装提示](./img/21.jpg)

7. 选择导出SSL根证书

![导出根证书1](./img/22.jpg)

8. 选择第二项，导出.pem格式的证书

![导出根证书2](./img/23.jpg)

9. 在手机设置中搜索"证书"关键字

![搜索证书](./img/24.jpg)

10. 选择CA证书,在提示界面选择仍然安装

![选择CA证书](./img/25.jpg)

11. 之后依次进入 /内部存储/HttpCanary/cert 目录

![进入HttpCanary目录](./img/26.jpg)

12. 点击.pem文件进行安装

![选择.pem文件](./img/27.jpg)

13. 随后采用相同方式将证书安装至"V*N和应用用户证书"

![继续安装](./img/28.jpg)

14. <span id="14"></span>回到设置页，选择要抓包的目标应用

![选择目标应用](./img/29.jpg)

15. 选择右上角的加号

![选择右上角的加号](./img/30.jpg)

16. 搜索"4399"并选中

![选择4399](./img/31.jpg)

17. 至此，证书安装及设置过程完成

##### 正式抓包过程

18. 在HttpCanary首页点击右下角纸飞机，开始抓包

![开始抓包](./img/32.jpg)

19. 进入加速卡页面的前一页面（签到页面）

![签到页面](./img/33.jpg)

20. 加载完毕后清空抓包列表

![清空步骤1](./img/34.jpg)

21. 随后进入积分及加速卡页面

![点击进入加速卡页面](./img/35.jpg)

22. 等待加速卡页面加载出积分后停止抓包

![等待加载出积分](./img/36.jpg)

23. 停止抓包（红色箭头）之后点击小框中间的放大符号（蓝色箭头）回到HttpCanary页面

![停止抓包并返回主页面](./img/37.jpg)

24. 选择右上角放大镜对封包进行筛选

![选择放大镜](./img/38.jpg)

25. 选择HTTP方法

![选择HTTP方法](./img/39.jpg)

26. 仅选中POST方法

![POST](./img/40.jpg)

27. 回到主页，选择具有红框特征的封包(域名为绿色划线部分)，任意选择一个进入即可

【更正】目前域名更新为huodong2.4399.com,即绿色划线部分要等于该域名。
【注意】4399目前增加了防外挂的数美验证，请注意raw部分是否携带smid字段，如封包中不包含raw字段，脚本会主动提示，请尝试更换封包重新解析，或使用脚本自动生成的smid【不推荐，有可能会导致封号】。

![筛选封包](./img/41.jpg)

28. 进入后选择请求页（红色箭头）

![进入请求页](./img/42.jpg)

29. 选择raw选项卡(红色箭头)

![raw选项卡](./img/43.jpg)

30. 全选并复制

![全选复制](./img/44.jpg)

31. 通过各种方式发送到电脑，在软件中解析封包即可

![发送到电脑](./img/45.jpg)

### 如何在电脑端使用fd快速抓包插件抓到我们需要的封包【已废弃】

【注意】由于4399域名更新，fd快速抓包插件已无法使用（由于源代码遗失），请参考手机抓包教程或自行摸索。

##### 电脑端(只需设置一次)
1. 安装Fiddler Classic(此步略过)
2. 找到Fiddler的安装位置，进入Script文件夹

![找到Script文件夹](./img/1.png)

3. 将插件([fd快速抓包插件.dll](./fd快速抓包插件.dll),**不能使用的话自行改名为4399_JS.dll**)复制到这个文件夹中

![复制文件](./img/2.png)

4. 打开Fiddler，发现右边标签栏中出现插件名称

![打开Fiddler](./img/3.png)

5. 记录下Fiddler主机的ip地址，将鼠标移到右上角的标志上即可查看

![记录ip地址](./img/4.png)

6. 此时软件还不能抓到HTTPS的加密包，接下来进行下一步操作
在菜单栏中选择工具→选项

![打开菜单](./img/5.png)

7. 在标签页中选择HTTPS，勾选以下内容：

![勾选选项](./img/6.png)

8. 点击操作按钮，选择信任根证书

![信任根证书](./img/7.png)

9. 接下来会弹出两个对话框，均选择是/YES

![对话框1](./img/8.png)
![对话框2](./img/9.png)

10. 接下来选择标签【连接】，进行如下勾选

![连接标签](./img/10.png)

11. 点击确认保存设置，重启Fiddler。

至此，电脑端的设置结束
##### 手机端(不同手机设置可能有所区别)
12. 接下来设置手机端，打开手机/模拟器的WiFi设置页面

![wifi设置](./img/11.jpg)

13. 长按当前使用的WiFi，选择修改网络

![修改网络](./img/12.jpg)

14. 选择代理为手动，将刚才记录的Fiddler所在的主机的ip地填进去，端口在刚才的步骤中可以修改，默认为8888，保存
**注意！进行此操作之后，所有的流量都会通过Fiddler软件，Fiddler软件必须处于开启状态，手机才可以联网。抓包结束之后请及时将代理修改为"无"**

![修改代理](./img/13.jpg)

15. 此时，手机(模拟器)上所有软件的流量都将经过电脑的Fiddler。
回到Fiddler，进入刚才安装的插件页，点击开始捕获

![开始捕获](./img/14.png)

16.	之后在手机/模拟器端进入加速卡页面

![进入页面](./img/15.jpg)

17. 电脑端将自动筛选出指定封包内容，按照指示进行操作即可

![筛选成功](./img/16.png)

### 注意事项
1. **【非常重要】抢加速卡必须进行微信绑定，请提前根据指示完成绑定**
2. 每天需要输入一次验证码，请点击>准备>加速卡验证完成这一步，不填写的话无法自动抢加速卡
3. 建议游戏自动签到与自动抢加速卡功能同时使用，否则会遇到加速卡到上限，无法再获得的情况
4. 模拟器可能会出现无法获取积分的情况，请尝试修改封包中的User-Agent，如果软件仍无法使用，请切换实机安装游戏盒。
5. 自动抢奖品仅为测试功能，不保证能抢到奖品，敬请期待之后【可能并不存在】的JS版本
6. 软件/插件仅供交流学习使用，侵权必删

